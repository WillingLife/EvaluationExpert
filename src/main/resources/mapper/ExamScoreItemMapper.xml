<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smartcourse.mapper.ExamScoreItemMapper">

    <update id="batchUpdateExamScoreItemSelective">
        <foreach collection="list" item="item" separator=";">
            UPDATE evaluation_expert.exam_score_item
            <trim prefix="SET" suffixOverrides=",">
                <if test="item.scoreId != null">
                    score_id = #{item.scoreId},
                </if>
                <if test="item.examItemId != null">
                    exam_item_id = #{item.examItemId},
                </if>
                <if test="item.score != null">
                    score = #{item.score},
                </if>
                <if test="item.answer != null">
                    answer = #{item.answer},
                </if>
                <if test="item.autoJudgeDetailJson != null">
                    auto_judge_detail_json = #{item.autoJudgeDetailJson},
                </if>
                <if test="item.remark != null">
                    remark = #{item.remark},
                </if>
                <if test="item.gradeTime != null">
                    grade_time = #{item.gradeTime},
                </if>
                <if test="item.deleted != null">
                    deleted = #{item.deleted},
                </if>
                update_time = NOW(),
            </trim>
            WHERE id = #{item.id}
        </foreach>
    </update>

    <insert id="submit">
        INSERT INTO evaluation_expert.exam_score_item(score_id, exam_item_id, answer, create_time, update_time)
        <foreach collection="examScoreItems" item="i" separator=" UNION ALL ">
            SELECT
            #{i.scoreId} as score_id,
            (SELECT id FROM evaluation_expert.exam_item WHERE question_id = #{i.questionId}) as exam_item_id,
            #{i.answer} as answer,
            #{i.createTime} as create_time,
            #{i.updateTime} as update_time
        </foreach>
    </insert>

    <update id="batchUpdateExamScoreItemSelectiveByScoreIdAndExamItemId">
        <foreach collection="list" item="item" separator=";">
            UPDATE evaluation_expert.exam_score_item
            <trim prefix="SET" suffixOverrides=",">
                <if test="item.score != null">
                    score = #{item.score},
                </if>
                <if test="item.answer != null">
                    answer = #{item.answer},
                </if>
                <if test="item.autoJudgeDetailJson != null">
                    auto_judge_detail_json = #{item.autoJudgeDetailJson},
                </if>
                <if test="item.remark != null">
                    remark = #{item.remark},
                </if>
                <if test="item.gradeTime != null">
                    grade_time = #{item.gradeTime},
                </if>
                <if test="item.deleted != null">
                    deleted = #{item.deleted},
                </if>
                update_time = NOW(),
            </trim>
            WHERE score_id = #{item.scoreId}
              AND exam_item_id = #{item.examItemId}
        </foreach>
    </update>

</mapper>
